/*

   Midori JS Framework 2010.06 Copyright (c) 2008-2010 Aycan Gulez
   http://www.midorijs.com

   Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the "Software"), to deal in the Software without
   restriction, including without limitation the rights to use,
   copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following
   conditions:

   The above copyright notice and this permission notice shall be
   included in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   OTHER DEALINGS IN THE SOFTWARE.

   -------

   Additions: Andy Devendorf - 2011
   added: fadeOut, fadeIn, slide, getStylePos, getOpacity
   removed: a lot
*/
var midori={browserType:window.opera?"Opera":((navigator.userAgent.indexOf("WebKit")!=-1)?"Safari":((navigator.userAgent.indexOf("MSIE")!=-1)?"MSIE":"Gecko")),browserOS:(navigator.userAgent.indexOf("Windows")!=-1)?"Win":((navigator.userAgent.indexOf("Macintosh")!=-1)?"Mac":"Other"),domReady:[],each:function(d,b,a){var e=d.firstChild;while(e){if(!a){b(e)}if(e.firstChild){this.each(e,b,a)}if(a){b(e)}e=e.nextSibling}},sibling:function(c,b){var a=c;if(b=="next"){do{a=a.nextSibling}while(a&&a.nodeType==3)}else{if(b=="prev"){do{a=a.previousSibling}while(a&&a.nodeType==3)}}return(a==c)?false:a},parseSelectors:function(b){var k=this.trim(b).split("");var l=-1;var a="";var d=[],n=[],e=[];var m=false,g=false,h=false;for(var f=0,j=k.length;f<j;f++){if(m){if(g){switch(k[f]){case'"':h=!h;break;case"]":if(!h){n[l].push(a);g=false;a=""}break;case"\\":a+=k[++f];break;default:a+=k[f]}}else{switch(k[f]){case"[":g=true;break;case" ":case">":case",":m=false;e[l]=k[f];break;case"\\":d[l]+=k[++f];break;default:d[l]+=k[f]}}}else{switch(k[f]){case" ":case">":case",":e[l]+=k[f];break;default:m=true;d[++l]=k[f];n[l]=[]}}}return{elements:d,attrs:n,separators:e}},processAttrs:function(e,c,g){for(var f=0,d=c.length,b;f<d;f++){b=(c[f]=="class")?(e.className?e.className:null):e.getAttribute(c[f]);switch(typeof g[f]){case"undefined":if(b==null){return false}break;case"string":if(b==g[f]){return false}break;default:if(!g[f].test(b)){return false}}}return true},processPseudo:function(e,h,d,b){var a,f,g=[],l=0;if(!(f=e.parentNode.getAttribute("midorinodekey"))){e.parentNode.setAttribute("midorinodekey",f=Math.random().toString().substr(2))}if(a=this.pCache[f]){g=a.parentChildren,l=a.pI}else{var i=e.parentNode.firstChild;while(i){if(i.nodeType==1){g.push(i)}i=i.nextSibling}this.pCache[f]={parentChildren:g,pI:0}}var j=g.length;switch(h){case"first-child":if(e==g[0]){return true}break;case"last-child":if(e==g[j-1]){return true}break;case"only-child":if(j==1){return true}break}if(h=="nth-child"){var k=d*l+b;var m=-50;while(k>-50&&k<=j){if(k>=0&&g[k-1]==e){this.pCache[f]["pI"]=(d>=0)?l+1:0;return true}l++,k+=d;if(k==m){break}m=k}}},getMatches:function(u,k,t,m){this.pCache={};var b=[],h=[];var j,g,d,e,l,f,p,o;this.postProcess=function(i){if(!r&&!e){b.push(i);return}var a=true;if(r&&!this.processAttrs(i,t,h)){a=false}if(e&&!this.processPseudo(i,l,p,o)){a=false}if(a){b.push(i)}};for(var q=0,r=t.length;q<r;q++){j=t[q].match(/([a-z0-9_-]+)\s*([=^$*|~!]{0,2})\s*"?([^"]*)"?$/i);t[q]=j[1];switch(j[2]){case"=":h[q]=new RegExp("^"+j[3]+"$","i");break;case"^=":h[q]=new RegExp("^"+j[3],"i");break;case"$=":h[q]=new RegExp(j[3]+"$","i");break;case"*=":h[q]=new RegExp(j[3],"i");break;case"~=":h[q]=new RegExp("^"+j[3]+"$|^"+j[3]+"\\s|\\s"+j[3]+"\\s|\\s"+j[3]+"$","i");break;case"!=":h[q]=j[3]}}if(k.indexOf(":")!=-1){j=k.split(":");k=j[0];e=j[1].match(/([a-z-]+)\(?([a-z0-9+-]*)\)?/i);l=e[1].toLowerCase();switch(f=e[2].toLowerCase()){case"odd":f="2n+1";break;case"even":f="2n"}j=f.match(/([0-9+-]*)(n?)([0-9+-]*)/i);p=parseInt(j[2]?(j[1]?((j[1]=="-")?-1:j[1]):1):0);o=parseInt(j[3]?j[3]:((j[1]&&!j[2])?j[1]:0))}if(k.indexOf("#")!=-1){this.postProcess(document.getElementById(k.substr(k.indexOf("#")+1)))}else{if(k.indexOf(".")!=-1){j=k.split(".");var n=k.substr(j[0].length+1).replace("."," ");var c=new RegExp("^"+n+"$|^"+n+"\\s|\\s"+n+"\\s|\\s"+n+"$","i");g=u.getElementsByTagName(j[0]?j[0]:"*");for(q=0,d=g.length;q<d;q++){if((!m&&c.test(g[q].className))||(m&&c.test(g[q].className)&&g[q].parentNode==u)){this.postProcess(g[q])}}}else{if(k=="*"||/^[A-Za-z0-9]+$/.test(k)){for(q=0,g=u.getElementsByTagName(k),d=g.length;q<d;q++){if(!m||(m&&g[q].parentNode==u)){this.postProcess(g[q])}}}}}return b},get:function(selectorText,startAt){var selectors=this.parseSelectors(selectorText);var numS=selectors.elements.length;if(!startAt){startAt=document}if(numS==1){var idMatch=selectors.elements[0].match(/^[a-z0-9*]*#([^,:]+)$/i);if(idMatch&&selectors.attrs[0]==""&&selectors.separators==""){return document.getElementById(idMatch[1])}}var objs=this.getMatches(startAt,selectors.elements[0],selectors.attrs[0]);var allObjs=[],newObjs,separator;for(var i=1;i<numS;i++){newObjs=[];separator=this.trim(selectors.separators[i-1]);if(separator==","){allObjs=this.concatUnique(allObjs,objs);objs=this.getMatches(startAt,selectors.elements[i],selectors.attrs[i])}else{var oneLevelOnly=(separator==">")?true:false;for(var j=0,numObjs=objs.length;j<numObjs;j++){if(!this.inArray(objs[j],newObjs)){newObjs=this.concatUnique(newObjs,this.getMatches(objs[j],selectors.elements[i],selectors.attrs[i]),oneLevelOnly)}}objs=newObjs}}allObjs=this.concatUnique(allObjs,objs);allObjs.apply=function(p){for(var i=0,numObjs=this.length;i<numObjs;i++){(typeof p=="function")?p(this[i]):eval("this[i]."+p)}};return allObjs},getCssRule:function(e,g,f){var b=[];var h=document.styleSheets[e];h=h.rules?h.rules:h.cssRules;g=g.toLowerCase();f=(this.browserType=="Safari")?f.replace(/([A-Z])/,"-$1").toLowerCase():f.toLowerCase();for(var d=0,a=h.length;d<a;d++){if(g=="*"||h[d].selectorText.toLowerCase()==g){for(var c in h[d].style){if(this.browserType=="Safari"){if(h[d].style[c].toLowerCase&&h[d].style[c].toLowerCase()==f){if(g=="*"){b[h[d].selectorText]=value}else{return h[d].style[h[d].style[c]]}}}else{if(c.toLowerCase()==f){if(g=="*"){b[h[d].selectorText]=h[d].style[c]}else{return h[d].style[c]}}}}}}return b},setStyles:function(c,b){for(var a in b){(a=="float")?this.setFloat(c,b[a]):c.style[a]=b[a]}},setAttributes:function(c,b){for(var a in b){(a=="className")?c.className=b[a]:c.setAttribute(a,b[a])}},removeNode:function(a){return a.parentNode.removeChild(a)},addEventListener:function(b,a,c){this.safariReady=function(){this.readyTimer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){midori.runReadyEvents()}},10)};this.msieReady=function(){document.write('<script id="midori_onload" src="javascript: {}" defer="true"><\/script>');this.get("#midori_onload").onreadystatechange=function(){if(this.readyState=="complete"){midori.runReadyEvents()}}};if(b.addEventListener){if(a=="ready"){switch(this.browserType){case"Safari":this.domReady.push(c);if(!this.readyTimer){this.safariReady()}return;case"Opera":case"Gecko":a="DOMContentLoaded";break;default:a="load"}}b.addEventListener(a,c,false);return}if(a=="ready"){if(!this.domReady.length){this.msieReady()}this.domReady.push(c);return}b.attachEvent("on"+a,c)},runReadyEvents:function(){if(this.readyTimer){clearInterval(this.readyTimer)}for(var a=0,b=this.domReady.length;a<b;a++){this.domReady[a]()}},getEventTarget:function(a){var b=a.target?a.target:a.srcElement;if(b.nodeType==3){b=b.parentNode}return b},getMousePos:function(a){if(a.targetTouches&&a.targetTouches.length){return{x:a.targetTouches[0].pageX,y:a.targetTouches[0].pageY}}else{if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}else{return{x:a.clientX+document.documentElement.scrollLeft-document.body.clientLeft,y:a.clientY+document.documentElement.scrollTop-document.body.clientTop}}}},preventBubble:function(a){a.stopPropagation?a.stopPropagation():window.event.cancelBubble=true},preventDefault:function(a){a.preventDefault?a.preventDefault():window.event.returnValue=false},getFloat:function(a){return((this.browserType=="MSIE")?a.style.styleFloat:a.style.cssFloat)},setFloat:function(b,a){(this.browserType=="MSIE")?b.style.styleFloat=a:b.style.cssFloat=a},getCookie:function(e){var c=document.cookie.split("; ");for(var a=0,b=c.length;a<b;a++){var d=c[a].split("=");if(d[0]==e){return unescape(d[1].replace(/\+/g," "))}}},setCookie:function(c,e,a,f,d){var b=new Date();document.cookie=c+"="+escape(e)+"; expires="+b.toUTCString(b.setSeconds(a))+(f?"; path="+f:"")+(d?"; domain="+d:"")},convertToFields:function(b,f,c){for(var d in c){if(typeof c[d]=="object"){this.convertToFields(b,f+"["+d+"]",c[d])}else{var e=document.createElement("input");this.setAttributes(e,{type:"hidden",name:f+"["+d+"]",value:c[d]});b.appendChild(e)}}},replace:function(a,e){if(!e){return a}var d=a.match(/:[A-Za-z0-9_]+/g).sort().reverse();for(var b=0,c=d.length;b<c;b++){a=a.replace(d[b],e[d[b].substr(1)])}return a},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},uniqid:function(a){return Math.floor(Math.random()*(a?a:100000))},concatUnique:function(c,b){var a=[];for(var d=0,e=b.length;d<e;d++){if(!this.inArray(b[d],c)){a.push(b[d])}}return c.concat(a)},implode:function(f,b){if(typeof b!="object"){return b}var g="";if(b.length&&!b.propertyIsEnumerable("length")){for(var e=0,d=b.length;e<d;e++){g+=f+b[e]}}else{for(var c in b){g+=f+b[c]}}return g.substr(f.length)},inArray:function(c,b){for(var e=0,d=b.length;e<d;e++){if((c!=null&&b[e].constructor==Array&&c.constructor==Array&&b[e].toString()==c.toString())||(b[e]==c)){return true}}},getPos:function(c,a){var d=0,b=0;a=a?a.offsetParent:null;while(c.offsetParent!=a){d+=c.offsetLeft,b+=c.offsetTop-c.scrollTop,c=c.offsetParent}return{x:d,y:b}},getStylePos:function(b){var c=0,a=0;if(!b.style.left){b.style.left=0+"px"}c=parseInt(b.style.left);a=parseInt(b.style.top);return{x:c,y:a}}};var midoriFX={intervals:{},lastIntervalId:0,queue:{},getOpacity:function(a){currOpacity=a.style.opacity;return currOpacity},getOutsideSize:function(c,d){var b=d=="width"?c.offsetWidth:c.offsetHeight;c.style[d]=b.toString()+"px";var a=(d=="width"?c.offsetWidth:c.offsetHeight)-b;c.style[d]=(b-a).toString()+"px";return a},showWithAnim:function(b){var a=this.intervals[b.intervalKey].newSize?false:true;this.intervals[b.intervalKey].newSize+=Math.round((b.elementSize-this.intervals[b.intervalKey].newSize)/2);if(this.intervals[b.intervalKey].newSize<b.elementSize){b.element.style[b.what]=this.intervals[b.intervalKey].newSize.toString()+"px"}else{clearInterval(this.intervals[b.intervalKey].intervalId);b.element.style[b.what]=b.elementSize.toString()+"px";b.element.style.overflow="visible";if(b.callback){b.callback(b.element)}}if(a){b.element.style.display="block"}},show:function(f,e,d){var c=d?"width":"height";var a=midori.get("#"+f);var b={intervalKey:Math.random(),element:a,callback:e,what:c};midori.setStyles(a,{overflow:"hidden",visibility:"hidden",display:"block"});b.elementSize=(d?a.offsetWidth:a.offsetHeight)-this.getOutsideSize(a,c),midori.setStyles(a,{display:"none",visibility:"visible"});this.intervals[b.intervalKey]={newSize:0,intervalId:setInterval(function(){midoriFX.showWithAnim(b)},40)}},hideWithAnim:function(c){var b=(c.what=="width"?c.element.offsetWidth:c.element.offsetHeight)-c.outsideSize;var a=c.constantSpeed?c.oldSize-4:Math.round(b/1.5);if(a>2){c.element.style[c.what]=a.toString()+"px";c.element.style.opacity=a/50}else{clearInterval(this.intervals[c.intervalKey].intervalId);c.element.style.display="none";c.element.style[c.what]=c.elementSize.toString()+"px";c.element.style.opacity=1;if(c.callback){c.callback(c.element)}}},hide:function(h,g,c,f){var e=f?"width":"height";var b=midori.get("#"+h);var a=this.getOutsideSize(b,e);var d={intervalKey:Math.random(),element:b,outsideSize:a,elementSize:(f?b.offsetWidth:b.offsetHeight)-a,callback:g,constantSpeed:c,what:e};b.style.overflow="hidden";this.intervals[d.intervalKey]={intervalId:setInterval(function(){midoriFX.hideWithAnim(d)},40)}},fadeOutWithAnim:function(b){var a=parseFloat(this.getOpacity(b.element));a=Math.round(a*10)/10;var c=a-0.1;c=Math.round(c*10)/10;if(c>b.end){b.element.style.opacity=c;b.element.style.filter="alpha(opacity="+parseFloat(c)*100+")"}else{clearInterval(this.intervals[b.intervalKey].intervalId);if(b.end=="0"){b.element.style.display="none"}b.element.style.opacity=b.end;b.element.style.filter="alpha(opacity="+parseFloat(b.end)*100+")";if(b.callback){b.callback(b.element)}}},fadeOut:function(h,e,a,g){var b=(e)?b=e:b=40;if(parseInt(e)){b=e}else{(e=="slow")?b=40:b=20}var c=(a)?c=a:c=0;var d=midori.get("#"+h);if(!d.style.opacity){d.style.opacity=1;d.style.filter="alpha(opacity=100)"}var f={intervalKey:Math.random(),element:d,end:c,callback:g};d.style.overflow="hidden";this.intervals[f.intervalKey]={intervalId:setInterval(function(){midoriFX.fadeOutWithAnim(f)},b)}},fadeInWithAnim:function(b){var a=parseFloat(this.getOpacity(b.element));a=Math.round(a*10)/10;var c=a+0.1;c=Math.round(c*10)/10;if(c<b.end){b.element.style.opacity=c;b.element.style.filter="alpha(opacity="+parseFloat(c)*100+")"}else{clearInterval(this.intervals[b.intervalKey].intervalId);b.element.style.opacity=b.end;b.element.style.filter="alpha(opacity="+parseFloat(b.end)*100+")";if(b.callback){b.callback(b.element)}}},fadeIn:function(h,e,a,g){var b=(e)?b=e:b=40;if(parseInt(e)){b=e}else{(e=="slow")?b=40:b=20}var c=(a)?c=a:c=1;var d=midori.get("#"+h);if(d.style.display=="none"){d.style.display="block"}if(!d.style.opacity){d.style.opacity=0;d.style.filter="alpha(opacity=0)"}var f={intervalKey:Math.random(),element:d,end:c,callback:g};d.style.overflow="hidden";this.intervals[f.intervalKey]={intervalId:setInterval(function(){midoriFX.fadeInWithAnim(f)},b)}},slideWithAnim:function(c){var b=midori.getStylePos(c.element).x;(c.end>b)?sDir=1:sDir=-1;var a=b+c.frameSkip*sDir+"px";if(sDir==1){if(midori.getStylePos(c.element).x<c.end-c.frameSkip-1){c.element.style.left=a}else{clearInterval(this.intervals[c.intervalKey].intervalId);c.element.style.left=c.end+"px";if(c.callback){c.callback(c.element)}}}else{if(midori.getStylePos(c.element).x>c.end+c.frameSkip+1){c.element.style.left=a}else{clearInterval(this.intervals[c.intervalKey].intervalId);c.element.style.left=c.end+"px";if(c.callback){c.callback(c.element)}}}},slide:function(g,e,c,f){var c=(c)?c=c:c=5;if(parseInt(c)){frameSkip=c}else{(c=="slow")?frameSkip=1:frameSkip=10}var b=midori.get("#"+g);var a=midori.getStylePos(b).x+e;if(!b.style.left){b.style.left=0+"px"}if(!b.style.position){b.style.position="absolute"}var d={intervalKey:Math.random(),element:b,dist:e,end:a,frameSkip:frameSkip,callback:f};b.style.overflow="hidden";this.intervals[d.intervalKey]={intervalId:setInterval(function(){midoriFX.slideWithAnim(d)},15)}},scrollToWithAnim:function(b,a){if(Math.abs(a-this.intervals[b].scrollPos)>10){this.intervals[b].scrollPos+=Math.round((a-this.intervals[b].scrollPos)/8);scrollTo(0,this.intervals[b].scrollPos)}else{clearInterval(this.intervals[b].intervalId)}},scrollTo:function(e,a){var c=midori.getPos(midori.get("#"+e)).y+(a?a:0);var b=Math.random();var d=midori.getWindowDims();this.intervals[b]={scrollPos:d.scrollTop,intervalId:setInterval(function(){midoriFX.scrollToWithAnim(b,c)},15)}},sliderToWithAnim:function(c,a,b){var d=this.intervals[c];var e=Math.abs(b-d.targetPos);d.targetPos+=Math.round(e/8)*d.direction;a.style.marginLeft=-d.targetPos+"px";if(e<=0){clearInterval(d.intervalId)}},slider:function(c,d,b){var a=midori.get("#"+c);var g=midori.getPos(midori.get("#"+d),a).x+(b?b:0);var e=a.style.marginLeft?Math.abs(parseInt(a.style.marginLeft,10)):0;var f=Math.random();if(this.lastIntervalId){clearInterval(this.lastIntervalId)}this.intervals[f]={targetPos:e,direction:(e>g)?-1:1,intervalId:setInterval(function(){midoriFX.sliderToWithAnim(f,a,g)},15)};this.lastIntervalId=this.intervals[f].intervalId}};function midoriAjax(f,d,a){var c=this;this.cache={};this.callback=f;try{this.request=new XMLHttpRequest()}catch(b){try{this.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){this.request=new ActiveXObject("Microsoft.XMLHTTP")}}this.runCallback=function(g,e){if(!e){if(c.request.readyState!=4){return}c.responseText=c.request.responseText;c.responseXML=c.request.responseXML;c.status=c.request.status;c.cache[c.cacheKey]=c.responseText}c.callback(d)};this.post=function(g,k,m,l){var j;if(g.indexOf("?",0)===-1){whatCB=Math.round(Math.random()*100000)}else{whatCB=k}this.cacheKey=g+"?"+whatCB;if(a&&((j=this.cache[this.cacheKey])!=null)){this.responseText=j;this.runCallback("",true);return}this.request.onreadystatechange=this.runCallback;m=m?midori.trim(((m==true)?"GET":m).toUpperCase()):"POST";this.request.open(m,midori.inArray(m,["POST","PUT"])?g:g+(whatCB?"?"+whatCB:""),true);if(midori.inArray(m,["POST","PUT"])){this.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");this.request.setRequestHeader("Content-length",whatCB.length);this.request.setRequestHeader("Connection","close")}if(l){for(var h=0,e=l.length;h<e;h++){this.request.setRequestHeader(l[h][0],l[h][1])}}this.request.send(midori.inArray(m,["POST","PUT"])?whatCB:null)}}function cssTransObj(b,a){b.style.WebkitTransition=a;b.style.MozTransition=a;b.style.MsTransition=a;b.style.transition=a}(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))?cssTrans=true:cssTrans=false;
//cssTrans = false;
